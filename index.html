<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Dossi√™ de Visitas</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; background-color: #f9f9f9; display: flex; }
    .sidebar {
      width: 250px;
      background-color: #fff;
      border: 1px solid #ccc;
      border-radius: 8px;
      padding: 10px;
      margin-right: 20px;
      height: 90vh;
      overflow-y: auto;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    }
    .section-title {
      font-weight: bold;
      margin-top: 15px;
      margin-bottom: 5px;
      border-bottom: 1px solid #ccc;
      padding-bottom: 3px;
      color: #333;
    }
    .skhouse-item {
      padding: 8px;
      margin-bottom: 5px;
      background-color: #f0f0f0;
      border-radius: 6px;
      cursor: pointer;
    }
    .skhouse-item:hover {
      background-color: #e0e0e0;
    }
    .main {
      flex: 1;
    }
    .placeholder {
      margin-top: 40px;
      font-size: 18px;
      color: #666;
    }
    .imovel-container {
      text-align: center;
      margin-top: 40px;
    }
    .imovel-grid {
      display: flex;
      gap: 40px;
      justify-content: center;
      margin-top: 20px;
      flex-wrap: wrap;
    }
    .imovel-imagem {
      max-width: 500px;
    }
    .imovel-imagem img {
      width: 100%;
      max-height: 400px;
      border-radius: 8px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }
    .imovel-endereco {
      font-weight: bold;
      font-size: 18px;
      margin-bottom: 10px;
    }
    .imovel-infos {
      margin-top: 12px;
      font-size: 16px;
      color: #444;
    }
    .imovel-tags {
      margin-top: 10px;
    }
    .tag {
      display: inline-block;
      background-color: #007bff;
      color: white;
      padding: 4px 8px;
      margin: 2px;
      border-radius: 4px;
      font-size: 13px;
    }
    .imovel-preco {
      font-size: 20px;
      font-weight: bold;
      margin-top: 8px;
    }
    .imovel-link {
      margin-top: 8px;
      font-size: 15px;
    }
  </style>
</head>
<body>
  <div class="sidebar">
    <div id="skhouse-list"></div>
  </div>
  <div class="main">
    <h1>Dossi√™ de Visitas</h1>
    <div id="imovel" class="imovel-container"></div>
  </div>
  <script>
    function formatDateBr(dateStr) {
      if (!dateStr) return "-";
      const d = new Date(dateStr);
      return d.toLocaleDateString('pt-BR');
    }

    async function carregarCSV() {
      const response = await fetch('dados - visitas.csv');
      const csvText = await response.text();

      Papa.parse(csvText, {
        header: true,
        skipEmptyLines: true,
        complete: function(results) {
          const data = results.data;
          const hoje = new Date();
          const amanha = new Date();
          amanha.setDate(hoje.getDate() + 1);

          const hojeStr = hoje.toISOString().split('T')[0];
          const amanhaStr = amanha.toISOString().split('T')[0];

          const porHoje = [];
          const porAmanha = [];
          const porOutros = [];

          data.forEach(l => {
            if (l.dt_visita === hojeStr) porHoje.push(l);
            else if (l.dt_visita === amanhaStr) porAmanha.push(l);
            else porOutros.push(l);
          });

          const skhouseList = document.getElementById("skhouse-list");

          function adicionarSecao(titulo, lista) {
            if (!lista.length) return;
            const header = document.createElement("div");
            header.className = "section-title";
            header.textContent = `---- ${titulo} ----`;
            skhouseList.appendChild(header);
            lista.forEach(linha => {
              const div = document.createElement("div");
              div.className = "skhouse-item";
              div.textContent = linha.sk_house;
              div.onclick = () => mostrarImovel(linha);
              skhouseList.appendChild(div);
            });
          }

          adicionarSecao("Visitas de Hoje", porHoje);
          adicionarSecao("Visitas de Amanh√£", porAmanha);
          adicionarSecao("Outras Visitas", porOutros);

          function mostrarImovel(imovel) {
            const container = document.getElementById("imovel");
            container.innerHTML = "";

            const grid = document.createElement("div");
            grid.className = "imovel-grid";

            const imagemCol = document.createElement("div");
            imagemCol.className = "imovel-imagem";

            const endereco = document.createElement("div");
            endereco.className = "imovel-endereco";
            endereco.textContent = `${imovel.house_address}, ${imovel.house_neighborhood}`;

            const img = document.createElement("img");
            img.src = `https://www.quintoandar.com.br/img/${imovel.name}`;

            const infos = document.createElement("div");
            infos.className = "imovel-infos";
            infos.textContent = `${imovel.house_total_area} m¬≤ | ${imovel.house_bedrooms} quarto(s) | ${imovel.house_bathrooms} ban. | ${imovel.house_garages} vaga(s)`;

            const tagsDiv = document.createElement("div");
            tagsDiv.className = "imovel-tags";
            if (parseFloat(imovel.price) <= parseFloat(imovel.predicted_price_70)) {
              tagsDiv.innerHTML += `<div class="tag">üí≤ Super Pre√ßo</div>`;
            }
            const lastDiscountDate = new Date(imovel.last_price_down);
            const diffDays = (hoje - lastDiscountDate) / (1000 * 3600 * 24);
            if (!isNaN(diffDays) && diffDays <= 15) {
              tagsDiv.innerHTML += `<div class="tag">‚¨á Redu√ß√£o recente</div>`;
            }
            if (parseInt(imovel.vb) > 5) {
              tagsDiv.innerHTML += `<div class="tag">‚≠ê Muitas visitas</div>`;
            }

            const preco = document.createElement("div");
            preco.className = "imovel-preco";
            preco.textContent = `R$ ${Number(imovel.price).toLocaleString("pt-BR")}`;

            const link = document.createElement("div");
            link.className = "imovel-link";
            link.innerHTML = `<a href="https://www.quintoandar.com.br/imovel/${imovel.sk_house}/comprar/" target="_blank">Im√≥vel da sua visita no site</a>`;

            imagemCol.appendChild(endereco);
            imagemCol.appendChild(img);
            imagemCol.appendChild(infos);
            imagemCol.appendChild(tagsDiv);
            imagemCol.appendChild(preco);
            imagemCol.appendChild(link);
            grid.appendChild(imagemCol);

            container.appendChild(grid);
          }
        }
      });
    }

    carregarCSV();
  </script>
</body>
</html>
